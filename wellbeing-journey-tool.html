<script>
document.getElementById("downloadPdfBtn").addEventListener("click", function(e){
  e.preventDefault();

  if (!window.jspdf) {
    alert("PDF library not loaded. Please refresh the page.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({ unit: "pt", format: "a4" });

  let y = 50;
  const left = 40;
  const maxWidth = 515;

  // Header
  doc.setFontSize(12);
  doc.text("https://emotionalintelligencedeveloper.com/", left, 30);

  doc.setFontSize(18);
  doc.text("Social Media Reset â€“ Personal Summary", left, y);
  y += 30;

  doc.setFontSize(12);
  doc.text("Generated: " + new Date().toLocaleString(), left, y);
  y += 25;

  // Collect answers
  doc.setFontSize(14);
  doc.text("Your Answers", left, y);
  y += 20;

  doc.setFontSize(11);

  for (let i = 1; i <= 5; i++) {
    const q = document.querySelector(`.q[data-q="${i}"] h3`).innerText;
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    const ans = sel ? sel.parentElement.innerText.trim() : "Not answered";

    const qLines = doc.splitTextToSize(q, maxWidth);
    doc.text(qLines, left, y);
    y += qLines.length * 14;

    const aLines = doc.splitTextToSize("Answer: " + ans, maxWidth);
    doc.text(aLines, left + 10, y);
    y += aLines.length * 14 + 10;

    if (y > 750) {
      doc.addPage();
      y = 50;
    }
  }

  // Result
  const resultBox = document.getElementById("resultArea");
  if (resultBox && resultBox.innerText.trim()) {
    doc.setFontSize(14);
    doc.text("Your Reset Insight", left, y);
    y += 20;

    doc.setFontSize(11);
    const resultText = doc.splitTextToSize(resultBox.innerText, maxWidth);
    doc.text(resultText, left, y);
    y += resultText.length * 14 + 10;
  }

  // Footer
  doc.setFontSize(10);
  doc.text(
    "Created by Emotional Intelligence Developer",
    left,
    800
  );

  // Save
  const filename =
    "Social-Media-Reset-" +
    new Date().toISOString().slice(0,19).replace(/[:T]/g,"-") +
    ".pdf";

  doc.save(filename);
});
</script>
